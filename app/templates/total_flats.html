
{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

  <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary mb-3">‚Üê Back to Dashboard</a>

  <h2>Flats Info</h2>

  <!-- Add Flat Button -->
  <button id="addFlatBtn" class="btn btn-success mb-3">Add Flat</button>

  <!-- Flat Form (hidden by default) -->
  <form id="flatForm" method="POST" action="{{ url_for('main.save_flat') }}" style="display:none; margin-bottom: 20px;">
    <input type="hidden" name="flat_id" id="flat_id" value="">
    <div class="mb-2">
      <label>Flat Number:</label>
      <input type="text" name="flat_number" id="flat_number" required class="form-control">
    </div>
    <div class="mb-2">
      <label>Owner Name:</label>
      <input type="text" name="owner_name" id="owner_name" required class="form-control">
    </div>
    <div class="mb-2">
      <label>Owner Contact:</label>
      <input type="text" name="owner_contact" id="owner_contact" required class="form-control">
    </div>
    <div class="mb-2">
      <label>Tennant Name:</label>
      <input type="text" name="tennant_name" id="tennant_name" required class="form-control">
    </div>
    <div class="mb-2">
      <label>Tennant Contact:</label>
      <input type="text" name="tennant_contact" id="tennant_contact" required class="form-control">
    </div>

    <button type="submit" class="btn btn-primary">Save</button>
    <button type="button" id="cancelBtn" class="btn btn-secondary">Cancel</button>
  </form>

  <!-- Flats Table -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Flat Number</th>
        <th>Owner Name</th>
        <th>Owner Contact</th>
        <th>Tennant Name</th>
        <th>Tennant Contact</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for flat in flats %}
      <tr>
        <td>{{ flat.flat_number }}</td>
        <td>{{ flat.owner_name }}</td>
        <td>{{ flat.owner_contact }}</td>
        <td>{{flat.tennant_name}}</td>
        <td>{{flat.tennant_contact}}</td>
        <td>
          <!-- Edit Button -->
          <button class="btn btn-sm btn-primary edit-btn"
                  data-id="{{ flat.flat_id }}"
                  data-flat_number="{{ flat.flat_number }}"
                  data-owner_name="{{ flat.owner_name }}"
                  data-owner_contact="{{ flat.owner_contact }}"
                  data-tennant_name="{{ flat.tennant_name }}"
                  data-tennant_contact="{{ flat.tennant_contact }}">
            Edit
          </button>

          <!-- Delete Button Form -->
          <form method="POST" action="{{ url_for('main.delete_flat', flat_id=flat.flat_id) }}"
                style="display:inline;" 
                onsubmit="return confirm('Are you sure you want to delete this flat?');">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  // Show Add Flat form when Add button clicked
  document.getElementById('addFlatBtn').addEventListener('click', function() {
    clearForm();
    document.getElementById('flatForm').style.display = 'block';
  });

  // Edit button click fills form and shows it
  document.querySelectorAll('.edit-btn').forEach(button => {
    button.addEventListener('click', () => {
      document.getElementById('flat_id').value = button.dataset.id;
      document.getElementById('flat_number').value = button.dataset.flat_number;
      document.getElementById('owner_name').value = button.dataset.owner_name;
      document.getElementById('owner_contact').value = button.dataset.owner_contact;
      document.getElementById('tennant_name').value = button.dataset.tennant_name;
      document.getElementById('tennant_contact').value = button.dataset.tennant_contact;

      document.getElementById('flatForm').style.display = 'block';
    });
  });

  // Cancel button hides the form and clears inputs
  document.getElementById('cancelBtn').addEventListener('click', function() {
    clearForm();
    document.getElementById('flatForm').style.display = 'none';
  });

  // Clear form inputs helper function
  function clearForm() {
    document.getElementById('flat_id').value = '';
    document.getElementById('flat_number').value = '';
    document.getElementById('owner_name').value = '';
    document.getElementById('owner_contact').value = '';
    document.getElementById('tennant_name').value = '';
    document.getElementById('tennant_contact').value = '';
  }
</script>
{% endblock %}