
{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

  <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary mb-3">‚Üê Back to Dashboard</a>

  <h2>Flats Info</h2>

  <!-- Add Flat Button -->
  <button id="addFlatBtn" class="btn btn-success mb-3">Add Flat</button>

  <!-- Flat Form (hidden by default) -->
  <form id="flatForm" method="POST" action="{{ url_for('main.save_flat') }}" style="display:none; margin-bottom: 20px;">
    <input type="hidden" name="flat_id" id="flat_id" value="">
    <div class="mb-2">
      <label>Flat Number:</label>
      <input type="text" name="flat_number" id="flat_number" required class="form-control">
    </div>
    <div class="mb-2">
      <label>Owner Name:</label>
      <input type="text" name="owner_name" id="owner_name" required class="form-control">
    </div>
    <div class="mb-2">
      <label>Contact:</label>
      <input type="text" name="contact" id="contact" required class="form-control">
    </div>
    <div class="mb-2">
      <label>Email:</label>
      <input type="email" name="email" id="email" class="form-control">
    </div>
    <!-- <div class="mb-2">
      <label>Maintenance Status:</label>
      <select name="maintenance_status" id="maintenance_status" class="form-control">
        <option value="No Data">No Data</option>
        <option value="Pending">Pending</option>
        <option value="Paid">Paid</option>
      </select>
    </div> -->
    <button type="submit" class="btn btn-primary">Save</button>
    <button type="button" id="cancelBtn" class="btn btn-secondary">Cancel</button>
  </form>

  <!-- Flats Table -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Flat Number</th>
        <th>Owner Name</th>
        <th>Contact</th>
        <th>Email</th>
        <!-- <th>Maintenance Status</th> -->
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for flat in flats %}
      <tr>
        <td>{{ flat.flat_number }}</td>
        <td>{{ flat.owner_name }}</td>
        <td>{{ flat.contact }}</td>
        <td>{{ flat.email }}</td>
        <!-- <td>{{ flat.maintenance_status }}</td> -->
        <td>
          <!-- Edit Button -->
          <button class="btn btn-sm btn-primary edit-btn"
                  data-id="{{ flat.flat_id }}"
                  data-flat_number="{{ flat.flat_number }}"
                  data-owner_name="{{ flat.owner_name }}"
                  data-contact="{{ flat.contact }}"
                  data-email="{{ flat.email }}">
            Edit
          </button>

          <!-- Delete Button Form -->
          <form method="POST" action="{{ url_for('main.delete_flat', flat_id=flat.flat_id) }}"
                style="display:inline;" 
                onsubmit="return confirm('Are you sure you want to delete this flat?');">
            <button type="submit" class="btn btn-sm btn-danger">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  // Show Add Flat form when Add button clicked
  document.getElementById('addFlatBtn').addEventListener('click', function() {
    clearForm();
    document.getElementById('flatForm').style.display = 'block';
  });

  // Edit button click fills form and shows it
  document.querySelectorAll('.edit-btn').forEach(button => {
    button.addEventListener('click', () => {
      document.getElementById('flat_id').value = button.dataset.id;
      document.getElementById('flat_number').value = button.dataset.flat_number;
      document.getElementById('owner_name').value = button.dataset.owner_name;
      document.getElementById('contact').value = button.dataset.contact;
      document.getElementById('email').value = button.dataset.email;
      // document.getElementById('maintenance_status').value = button.dataset.maintenance_status;

      document.getElementById('flatForm').style.display = 'block';
    });
  });

  // Cancel button hides the form and clears inputs
  document.getElementById('cancelBtn').addEventListener('click', function() {
    clearForm();
    document.getElementById('flatForm').style.display = 'none';
  });

  // Clear form inputs helper function
  function clearForm() {
    document.getElementById('flat_id').value = '';
    document.getElementById('flat_number').value = '';
    document.getElementById('owner_name').value = '';
    document.getElementById('contact').value = '';
    document.getElementById('email').value = '';
    // document.getElementById('maintenance_status').value = 'No Data';
  }
</script>
{% endblock %}
