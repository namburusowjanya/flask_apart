{% extends 'base.html' %}
{% block title %}Credits - Apartment Maintenance{% endblock %}

{% block content %}
<style>
  body {
    font-family: system-ui;
    background: #f8fafc;
    color: #111;
  }

  .card {
    background: #fff;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.06);
    margin-bottom: 20px;
  }

  h1 {
    margin-top: 0;
    font-size: 20px;
  }

  .row {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }

  .col {
    flex: 1 1 200px;
    min-width: 180px;
  }

  label {
    font-size: 13px;
    color: #374151;
    margin-bottom: 4px;
    display: block;
  }

  input,
  select,
  textarea {
    width: 100%;
    padding: 8px 10px;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    box-sizing: border-box;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }

  th,
  td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #f1f5f9;
    font-size: 14px;
  }

  th {
    background: #ecfdf5;
    color: #0f766e;
    font-weight: 600;
  }

  button {
    background: #0ea5a0;
    color: #fff;
    border: none;
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
  }

  button.secondary {
    background: #6366f1;
  }

  .muted {
    color: #6b7280;
  }
</style>

<div class="card">
  <h1>Add Credit</h1>
  <form method="POST" action="{{ url_for('main.add_credit') }}">
    <div class="row">
      <div class="col">
        <label for="flat">Flat</label>
        <select name="flat_no" id="flat" required>
          <option value="">Select flat</option>
          {% for f in flats %}
            <option value="{{ f.flat_number }}">{{ f.flat_number }} — {{ f.owner_name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col">
        <label for="amount">Amount (₹)</label>
        <input type="number" step="0.01" name="amount" id="amount" required>
      </div>
      <div class="col">
        <label for="reason">Reason</label>
        <textarea name="reason" id="reason" rows="2" placeholder="Optional note"></textarea>
      </div>
      <div class="col" style="align-self:end">
        <button type="submit">Save Credit</button>
      </div>
    </div>
  </form>
</div>

<div class="card">
  <h1>Existing Credits</h1>
  <table>
    <thead>
      <tr>
        <th>Bill id</th>
        <th>Flat</th>
        <th>Amount (₹)</th>
        <th>Reason</th>
        <th>Created At</th>
        <th>Used?</th>
      </tr>
    </thead>
    <tbody>
      {% if credits %}
        {% for c in credits %}
        <tr>
          <td>{{ c.bill_id }}</td>
          <td>{{ c.flat.flat_number if c.flat else c.flat_id }}</td>
          <td>₹{{ "%.2f"|format(c.amount) }}</td>
          <td>{{ c.reason or '' }}</td>
          <td>{{ c.created_at.strftime('%Y-%m-%d') }}</td>
          <td>{{ 'Yes' if c.used else 'No' }}</td>
        </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="6" class="muted">No credits found.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}